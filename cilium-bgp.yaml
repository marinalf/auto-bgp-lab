---
apiVersion: isovalent.com/v1
kind: IsovalentBGPClusterConfig
metadata:
 name: rack1
spec:
  nodeSelector:
    matchLabels:
      rack: "rack1"
  bgpInstances:
    - name: "cilium-rack1"
      localASN: 4282237230 # auto-generated by leaf1 (iBGP, AS-per rack design)
      peers:
        - name: "peer-rack1"
          interface: "eth1"
          peerConfigRef:
            name: "peer-config" 

apiVersion: isovalent.com/v1
kind: IsovalentBGPClusterConfig
metadata:
 name: rack2
spec:
  nodeSelector:
    matchLabels:
      rack: "rack2"
  bgpInstances:
    - name: "cilium-rack2"
      localASN: 4226831155 # auto-generated by leaf3 (iBGP, AS-per rack design)
      peers:
        - name: "peer-rack2"
          interface: "eth1"
          peerConfigRef:
            name: "peer-config" 

apiVersion: isovalent.com/v1
kind: IsovalentBGPClusterConfig
metadata:
 name: rack3
spec:
  nodeSelector:
    matchLabels:
      rack: "rack3"
  bgpInstances:
    - name: "cilium-rack3"
      localASN: 4215128366 # auto-generated by leaf4 (iBGP, AS-per rack design)
      peers:
        - name: "peer-rack3"
          interface: "eth1"
          peerConfigRef:
            name: "peer-config" 

---
apiVersion: isovalent.com/v1
kind: CiliumBGPPeerConfig
metadata:
  name: peer-config
spec:
  authSecretRef: bgp-auth-secret
  gracefulRestart:
    enabled: true
    restartTimeSeconds: 15
  families:
    - afi: ipv4
      safi: unicast
      advertisements:
        matchLabels:
          advertise: "pod-cidr"
    - afi: ipv6
      safi: unicast
      advertisements:
        matchLabels:
          advertise: "pod-cidr"

---
apiVersion: isovalent.com/v1
kind: CiliumBGPAdvertisement
metadata:
  name: pod-cidr-advert
  labels:
    advertise: pod-cidr
spec:
  advertisements:
    - advertisementType: "PodCIDR"
      attributes:
        communities:
          wellKnown: [ "no-export" ]
