feature bgp 

route-map TAG permit 10
  match tag 12345 

  ip prefix-list k8s-svc-ip seq 10 permit 192.168.200.0/24 le 32

route-map k8s-svc-ip-unchange permit 10
  match ip address prefix-list k8s-svc-ip 
  set ip next-hop unchanged
  set path-selection multipaths advertise
route-map k8s-svc-ip-unchange permit 20

  router bgp auto
  router-id auto
  bestpath as-path multipath-relax
  address-family ipv4 unicast
    redistribute direct route-map TAG
    maximum-paths 64
    additional-paths send
    additional-paths receive
  additional-paths selection route-map k8s-svc-ip-unchange
  address-family ipv6 unicast
    redistribute direct route-map TAG
    maximum-paths 64
    additional-paths send
    additional-paths receive
 neighbor Ethernet1/1-2
    remote-as external
    address-family ipv4 unicast
      route-map k8s-svc-ip-unchange out
    address-family ipv6 unicast
neighbor fd00:10:0:0::2
    remote-as internal
    address-family ipv4 unicast
      route-reflector-client
      next-hop-self
    address-family ipv6 unicast
      route-reflector-client
      next-hop-self
neighbor fd00:10:0:1::2
    remote-as internal
    address-family ipv4 unicast
      route-reflector-client
      next-hop-self
    address-family ipv6 unicast
      route-reflector-client
      next-hop-self

  int mgmt0
  no cdp enable

  interface loopback0
    ip address 10.31.31.31/32 tag 12345
    ipv6 address 2001::31/128 tag 12345

  interface ethernet 1/1-2
    no switchport
    ip forward
    ipv6 link-local use-bia
    no shutdown

  interface ethernet 1/6
    description cp-node
    no switchport
    ip forward
    ipv6 address fd00:10:0:0::1/64 tag 12345
    no shutdown

  interface ethernet 1/7
    description w-node1
    no switchport
    ip forward
    ipv6 address fd00:10:0:1::1/64 tag 12345
    no shutdown

